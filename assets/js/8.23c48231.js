(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{246:function(t,s,a){t.exports=a.p+"assets/img/koa1.d6b13ab4.gif"},247:function(t,s){t.exports="data:image/png;base64,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"},248:function(t,s,a){t.exports=a.p+"assets/img/STACK2.29183c76.png"},316:function(t,s,a){"use strict";a.r(s);var n=a(0),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"koa中间件大揭秘"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#koa中间件大揭秘"}},[t._v("#")]),t._v(" koa中间件大揭秘")]),t._v(" "),n("h2",{attrs:{id:"前言"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[t._v("#")]),t._v(" 前言")]),t._v(" "),n("p",[t._v("我们在使用koa的时候发现，其实koa只是对req，res进行了封装，但是很多一些功能如路由、静态资源、模板引擎等都没有支持，看过源码都知道koa的源码就那么一点。但是丰富的第三方中间件弥补了这个不足。接下来我们来揭开一下一些常用中间件的内部原理，你会发现其实koa的中间件真的大同小异。")]),t._v(" "),n("h2",{attrs:{id:"koa-bodyparser"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#koa-bodyparser"}},[t._v("#")]),t._v(" koa-bodyparser")]),t._v(" "),n("p",[t._v("我们先来简单看下 "),n("code",[t._v("koa-bodyparser")]),t._v(" 的基本用法")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Koa "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"koa"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" bodyParser "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"koa-bodyparser"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Koa")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("bodyParser")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 挂载中间件 koa-bodyparser")]),t._v("\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 渲染一个表单，表单提交时候请求接口 /login")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"GET"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/form"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('\n            <form action="/login" method="post">\n                <input type="text" name="username"/>\n                <input type="text" name="password"/>\n                <button>提交</button>\n            </form>\n        ')]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"POST"')]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/login"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//将接口得到的数据展示在页面上")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5050")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("上面的代码其实很简单，"),n("code",[t._v("/form")]),t._v(" 路由渲染一个表单组件，表单组件请求的是"),n("code",[t._v("/login")]),t._v(" 路由，而"),n("code",[t._v("/login")]),t._v("将得到的数据渲染在页面，我们来看下运行效果:")]),t._v(" "),n("p",[n("img",{attrs:{src:a(246),alt:"An image"}})]),t._v(" "),n("p",[t._v("知道 "),n("code",[t._v("koa-bodyparser")]),t._v(" 的基本用法之后，我们试一下自己实现一个类似功能的中间件")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("bodyParser")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" \n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 返回一个async函数")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("reject")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" arr "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'data'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("chunk")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                arr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("chunk"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("req"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'end'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Buffer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("concat")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arr"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toString")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将文件流赋值给 ctx.request.body")]),t._v("\n                "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("其实你会发现，内部就是这么简单，而且不难发现，"),n("code",[t._v("app.use()")]),t._v(" 方法在 "),n("code",[t._v("koa")]),t._v(" 中是接受一个 "),n("code",[t._v("async")]),t._v("函数的，根据"),n("code",[t._v("app.use(bodyParser())")]),t._v(" 来挂载中间件我们可以知道 "),n("code",[t._v("bodyParser()")]),t._v(" 返回的就是一个 "),n("code",[t._v("async")]),t._v(" 函数，而中间件的核心原理则是利用 "),n("code",[t._v("koa")]),t._v(" 中间件的洋葱机制，在一开始给 "),n("code",[t._v("ctx")]),t._v(" 上挂载一些属性或者方法，则在后面的 "),n("code",[t._v("arr.use()")]),t._v(" 中都可以通过 "),n("code",[t._v("ctx")]),t._v("来拿到对应挂载的方法。")]),t._v(" "),n("h2",{attrs:{id:"koa-static"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#koa-static"}},[t._v("#")]),t._v(" koa-static")]),t._v(" "),n("p",[n("code",[t._v("koa-static")]),t._v(" 的作用用一句话来概括就是，起一个静态服务，下面看下具体用法")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Koa "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"koa"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Koa")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'koa-static'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5050")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("以上代码的意思是，以当前目录为根目录起一个静态服务，通过 "),n("code",[t._v("http://localhost:5050/XXX")]),t._v(" 就可以获取到对应的资源了。")]),t._v(" "),n("p",[t._v("而且不难发现，"),n("code",[t._v("koa-static")]),t._v(" 的用法和 "),n("code",[t._v("koa-bodyparser")]),t._v(" 很像，都是"),n("code",[t._v("app.use(xxx())")]),t._v(" 的形式，那我们就来简单实现一个这个效果")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("pathname")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 因为 fs.stat 主要通过报错来判断当前路径文件存不存在 所以try catch处理")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" filePath "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path\n            filePath "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pathname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" filePath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 拿到绝对路径")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" statObj "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" fs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("stat")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filePath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("statObj"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("isDirectory")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果是目录，则拼接上 `index.html` ")]),t._v("\n                filePath "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filePath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'index.html'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n            ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" fs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFile")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filePath"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'utf-8'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//读取处理过的路径，然后返回")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n           "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果处理不了 就走下一个中间件")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("原理很简单，就是读当前传入路径的文件，有的话就赋值给 "),n("code",[t._v("ctx.body")]),t._v(" , 没有的话走下一个中间件")]),t._v(" "),n("h2",{attrs:{id:"koa-router"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#koa-router"}},[t._v("#")]),t._v(" koa-router")]),t._v(" "),n("p",[t._v("顾名思义，一个路由的第三方中间件，我们直接看它的基础用法")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Koa "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'koa'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Router "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'koa-router'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" router "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Router")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Koa")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nrouter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/hello'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("routes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5050")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("上诉代码主要是起一个"),n("code",[t._v("/hello")]),t._v("的"),n("code",[t._v("get")]),t._v("请求接口，返回"),n("code",[t._v("hello")]),t._v(", 大大的简化了"),n("code",[t._v("koa")]),t._v("对路由的操作，如"),n("code",[t._v('ctx.method === "GET" && ctx.path === "/hello"')]),t._v(" 类似的判断，我们自己实现的时候需要注意到一些细节，如 "),n("code",[t._v("Router")]),t._v(" 是一个类，"),n("code",[t._v("app.use()")]),t._v("挂载的是类上"),n("code",[t._v("routes")]),t._v("方法返回的函数，我们试下来实现一款简单的"),n("code",[t._v("koa-router")]),t._v(".")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Layer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//将栈中的结构抽取一个类 方便后序扩展")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("method"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("pathname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("callback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" method"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pathname "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" pathname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("callback "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" callback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("match")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("method")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//将匹配方法抽离出来")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" path "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("pathname "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" method"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("toLowerCase")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Router")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("constructor")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stack "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这里面存放着所有的路由关系")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pathname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("callback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 我们次调用get方法都会像内部数组放一层")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" layer "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Layer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'get'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" pathname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" callback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stack"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("push")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("compose")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("fns"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// compose原理 和koa类似 先抽取栈中的第一个执行, 将下一个函数作为第一个函数的参数next，以此递归")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("dispatch")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("index "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("===")]),t._v(" fns"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("length"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 边界值判断 避免爆了")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" callback "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fns"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("index"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("callback"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 拿到栈中每一项执行")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" Promise"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("callback")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("dispatch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("index"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("dispatch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("routes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 获取请求的路径")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" path "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// /hello")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" method "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("method"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// get")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" fns "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("stack"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("filter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("layer")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v("layer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("match")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("method"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//在存储的路由表中筛选出符合条件项")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("this")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("compose")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fns"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("next"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 进行组合")]),t._v("\n       "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nmodule"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" Router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("我们慢慢来体会一下 "),n("code",[t._v("koa-router")]),t._v(" 的内部流程\n首先我们使用"),n("code",[t._v("route.get('/xxx', callback)")]),t._v(" 的时候会调用 "),n("code",[t._v("Router")]),t._v("类上的"),n("code",[t._v("get")]),t._v("方法，该方法会将 "),n("code",[t._v("method")]),t._v(" "),n("code",[t._v("path")]),t._v(" "),n("code",[t._v("callback")]),t._v(" 通过 "),n("code",[t._v("Layer")]),t._v(" 类组装一下，存入 "),n("code",[t._v("stack")]),t._v("中，我们 "),n("code",[t._v("statck")]),t._v("的结构如下")]),t._v(" "),n("p",[n("img",{attrs:{src:a(247),alt:"An image"}})]),t._v(" "),n("p",[t._v("然后我们调用 "),n("code",[t._v("route.routes()")]),t._v(" 的时候，会根据当前请求的方法和路径去 "),n("code",[t._v("stack")]),t._v("中筛选出符合条件的项，将他们组合成一个大的函数，内部原理是和"),n("code",[t._v("koa")]),t._v("的中间件原理一样的，先执行第一个函数，将下一个函数作为第一个函数的参数"),n("code",[t._v("next")])]),t._v(" "),n("p",[n("img",{attrs:{src:a(248),alt:"An image"}})]),t._v(" "),n("p",[t._v("其实这只是实现"),n("code",[t._v("koa-router")]),t._v(" 的一小部分内容，还有很多如二级路由啊、参数处理啥的比较恶心，这里就不写了")]),t._v(" "),n("h2",{attrs:{id:"koa-views"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#koa-views"}},[t._v("#")]),t._v(" koa-views")]),t._v(" "),n("p",[t._v("一句话来说 "),n("code",[t._v("koa-views")]),t._v("就是用来实现模板引擎的，很简单")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Koa "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'koa'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" Router "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'koa-router'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" views "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'koa-views'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" app "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Koa")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" path "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'path'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" router "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Router")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("views")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'views'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    map"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        html"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ejs'")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//如果遇到.html 后缀的文件，用ejs模板处理")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nrouter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'/'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("render")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'hello'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'zf'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("router"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("routes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\napp"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("listen")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5050")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[t._v("先来理一下"),n("code",[t._v("koa-views")]),t._v(" 的基本用法吧，首先挂载中间件，声明一些参数，如 遇到"),n("code",[t._v(".html")]),t._v(" 后缀的文件用 "),n("code",[t._v("ejs")]),t._v(" 模板引擎来渲染，最后在  "),n("code",[t._v("ctx")]),t._v("上挂载一个"),n("code",[t._v("render()")]),t._v("方法，传入对应的数据来渲染对应的页面。知道原理之后，我们不妨自己来实现一下")]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("div",{staticClass:"highlight-lines"},[n("br"),n("br"),n("br"),n("div",{staticClass:"highlighted"},[t._v(" ")]),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br"),n("br")]),n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("views")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("dirname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("map"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("render")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("filename"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将方法挂载到 ctx.render")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" ejs "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("map"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 引用ejs模板 这里的做法有点low 其实应该遍历取出的")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" renderFile "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" util"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("promisify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ejs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("renderFile"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 调用ejs的方法渲染页面")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 渲染文件，成功后将结果返回去")]),t._v("\n            ctx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("renderFile")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("join")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("dirname"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("filename"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.html'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("await")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("next")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 增加逻辑后 继续向下执行 koa-static")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"总结"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#总结"}},[t._v("#")]),t._v(" 总结")]),t._v(" "),n("p",[t._v("通过对工作做经常用到的几个中间件进行了一波深入了解，相信大家对"),n("code",[t._v("koa")]),t._v("中间件的路子和形式都摸得差不多了。核心原理就是利用"),n("code",[t._v("koa")]),t._v("中的洋葱模型，一开始往"),n("code",[t._v("ctx")]),t._v("上挂载自己需要的属性或者方法，后序就可以通过"),n("code",[t._v("ctx")]),t._v("来调用啦。")])])}),[],!1,null,null,null);s.default=e.exports}}]);