(window.webpackJsonp=window.webpackJsonp||[]).push([[58],{305:function(t,s,a){"use strict";a.r(s);var r=a(0),n=Object(r.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"【小技巧】-小程序自动发布体验版脚本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#【小技巧】-小程序自动发布体验版脚本"}},[t._v("#")]),t._v(" 【小技巧】-小程序自动发布体验版脚本")]),t._v(" "),a("h2",{attrs:{id:"背景"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#背景"}},[t._v("#")]),t._v(" 背景")]),t._v(" "),a("p",[t._v("最近发现每次上传小程序测试包的时候都需要以下几步，拉最新代码 -> 打包小程序代码 -> 打开小程序开发者工具 -> 点击上传代码 -> 填写版本号等信息，发现完全可以抽离一个脚本来让他自动上传测试包")]),t._v(" "),a("h2",{attrs:{id:"auto-sh"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#auto-sh"}},[t._v("#")]),t._v(" auto.sh")]),t._v(" "),a("p",[t._v("我们来写这样一个脚本")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br"),a("br"),a("div",{staticClass:"highlighted"},[t._v(" ")]),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("#"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bin"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bash\n\n# 本地项目地址\nproject_dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/Users/chenying/shikamaru-weapp"')]),t._v("\n\n# 获取版本号\nversion"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("$"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n\n# 进入项目文件夹\ncd $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("project_dir"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n# 拉取代码\ncurrent_branch"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("git symbolic-ref --short -q HEAD")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 记录当前分支为止")]),t._v("\ngit add "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\ngit stash save "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'mp_experience_sh_68743423435434534534533543'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 缓存当前分支文件")]),t._v("\ngit checkout master "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 切换到master分支")]),t._v("\ngit pull rel master "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 拉取测试环境最新代码")]),t._v("\n\n# 编译代码\n# npm run build\nnpm run build "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 打包小程序代码")]),t._v("\n\n# 上传体验版\n# "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Applications"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("wechatwebdevtools"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Contents"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("MacOS"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("cli "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("u $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("@$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("project_dir"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dist\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Applications"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("wechatwebdevtools"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("Contents"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("MacOS"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("cli "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("u $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("version"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("@$"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("project_dir"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("dist "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 调用微信api自动上传体验版")]),t._v("\n\n# 还原之前代码\ngit checkout $"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("current_branch"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 切回git原来的分支")]),t._v("\ngit stash pop "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("$")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("git log "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("g stash "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("grep"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mp_experience_sh_68743423435434534534533543"')]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("pretty"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("format"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%gd"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 将暂存文件释放，还原之前的代码")]),t._v("\n")])])]),a("p",[t._v("这样的话我们只需要在终端执行命令")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("div",{staticClass:"highlight-lines"},[a("br"),a("br")]),a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v(" auto"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("sh 版本号\n")])])]),a("p",[t._v("就可以实现自动发布体验版了")])])}),[],!1,null,null,null);s.default=n.exports}}]);